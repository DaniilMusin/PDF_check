# PDF Document Classifier

Веб-сервис для автоматической классификации PDF-документов с использованием нейронной сети. Система извлекает текст из PDF-файлов, обрабатывает его и определяет тематическую категорию с помощью обученной модели машинного обучения.

## Быстрый старт

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Установка языковых моделей spaCy (опционально)

```bash
# Для поддержки русского языка
python -m spacy download ru_core_news_sm

# Для английского языка (базовая поддержка)
python -m spacy download en_core_web_sm
```

### Обучение модели

Перед первым использованием необходимо обучить модель:

```bash
# Быстрое обучение (рекомендуется для демонстрации)
python train_high_accuracy.py

# Полное обучение (занимает больше времени)
PYTHONPATH=src python src/model/train.py
```

### Запуск веб-сервера

```bash
PYTHONPATH=src python src/app/web.py
```

Сервер будет доступен по адресу: http://127.0.0.1:8080

## Функциональность

### Поддерживаемые категории

Система классифицирует документы по 20 категориям на основе датасета 20 Newsgroups:

- **Компьютерная графика** (comp.graphics)
- **Хоккей** (rec.sport.hockey) 
- **Медицина** (sci.med)
- **Автомобили** (rec.autos)
- **Электроника** (sci.electronics)
- **Космос** (sci.space)
- **Политика** (talk.politics.*)
- **Религия** (soc.religion.christian, talk.religion.misc)
- **Криптография** (sci.crypt)
- **Компьютерное железо** (comp.sys.*)
- **Атеизм** (alt.atheism)
- **Операционные системы** (comp.os.ms-windows.misc)
- **Мотоциклы** (rec.motorcycles)
- **Бейсбол** (rec.sport.baseball)
- **Продажи** (misc.forsale)
- **И другие категории**

### Основные возможности

- Извлечение текста из PDF с поддержкой трех библиотек (PyMuPDF, pdfminer.six, PyPDF2)
- Предобработка текста с токенизацией и лемматизацией (spaCy)
- Классификация с помощью глубокой нейронной сети (TensorFlow/Keras)
- Векторизация текста с использованием TF-IDF
- Веб-интерфейс с поддержкой drag & drop
- Русскоязычный интерфейс с переводом категорий
- Обработка ошибок и валидация файлов
- Современный адаптивный дизайн

## Архитектура

### Структура проекта

```
src/
├── app/              # Веб-приложение Flask
│   ├── web.py        # Основное приложение
│   ├── cli.py        # Интерфейс командной строки
│   └── templates/    # HTML шаблоны
├── model/            # Модуль машинного обучения
│   ├── train.py      # Обучение нейронной сети
│   ├── predict.py    # Классификация документов
│   ├── load.py       # Загрузка обученной модели
│   └── metrics.py    # Оценка качества модели
├── pdf_io/           # Извлечение текста из PDF
│   └── extractor.py  # Поддержка разных PDF библиотек
└── preprocessing/    # Обработка текста
    └── cleaner.py    # Токенизация и лемматизация
```

### Алгоритм машинного обучения

1. **Извлечение текста** - получение текстового содержимого из PDF
2. **Предобработка** - очистка, токенизация, лемматизация с spaCy
3. **Векторизация** - преобразование в TF-IDF признаки
4. **Нейронная сеть** - многослойный перцептрон для классификации
5. **Предсказание** - получение вероятностей для всех категорий

### Архитектура нейронной сети

- **Входной слой**: TF-IDF векторы (8000 признаков)
- **Первый скрытый слой**: 1024 нейрона с ReLU активацией
- **Второй скрытый слой**: 512 нейронов с ReLU активацией  
- **Третий скрытый слой**: 256 нейронов с ReLU активацией
- **Четвертый скрытый слой**: 128 нейронов с ReLU активацией
- **Выходной слой**: 20 нейронов с softmax активацией
- **Регуляризация**: Batch Normalization и Dropout
- **Оптимизатор**: Adam с learning rate 0.0008
- **Функция потерь**: Sparse categorical crossentropy

## Технические детали

### Зависимости

- **TensorFlow** - нейронная сеть и машинное обучение
- **scikit-learn** - TF-IDF векторизация и метрики
- **spaCy** - предобработка естественного языка
- **Flask** - веб-фреймворк
- **PyMuPDF, pdfminer.six, PyPDF2** - извлечение текста из PDF
- **loguru** - структурированное логирование
- **numpy** - научные вычисления

### Параметры обучения модели

- **Датасет**: 20 Newsgroups (около 19,000 документов)
- **Предобработка**: токенизация, лемматизация, удаление стоп-слов
- **Признаки**: TF-IDF с униграммами и биграммами
- **Размер словаря**: 8000 наиболее частых слов
- **Валидация**: stratified train/test split
- **Метрики**: accuracy, precision, recall, F1-score

### Конфигурация системы

- Максимальный размер файла: 10 МБ
- Поддерживаемые форматы: PDF
- Порт веб-сервера: 8080
- Режим разработки включен по умолчанию

## Использование

### Веб-интерфейс

1. Обучите модель (если еще не обучена):
   ```bash
   python train_high_accuracy.py
   ```

2. Запустите веб-сервер:
   ```bash
   PYTHONPATH=src python src/app/web.py
   ```

3. Откройте в браузере: http://127.0.0.1:8080

4. Загрузите PDF файл через интерфейс

5. Получите результат классификации с вероятностями

### Интерфейс командной строки

```bash
PYTHONPATH=src python src/app/cli.py path/to/document.pdf
```

### Программный интерфейс

```python
import sys
sys.path.append('src')
from model.predict import classify

# Классификация документа
results = classify('document.pdf', top_k=3)
for category, probability in results:
    print(f"{category}: {probability:.2%}")
```

## Тестирование

### Запуск тестов

```bash
python -m pytest tests/ -v
```

### Структура тестов

- `tests/test_extractor.py` - тесты извлечения текста из PDF
- `tests/test_cleaner.py` - тесты предобработки текста  
- `tests/test_model.py` - тесты модели машинного обучения
- `tests/conftest.py` - общие фикстуры для тестов

### Оценка качества модели

```bash
PYTHONPATH=src python src/model/metrics.py
```

## Качество модели

### Производительность

Обученная модель показывает следующие результаты на тестовых данных:

- **Общая точность**: 82.4%
- **Параметры модели**: 8.9 миллионов обучаемых параметров
- **Размер модели**: 101.8 МБ
- **Время инференса**: менее 1 секунды на документ

### Лучшие категории для классификации

- Компьютерная графика
- Спортивные статьи (хоккей, бейсбол)
- Медицинские публикации
- Научные статьи по электронике и космосу

### Сложные случаи

- Документы с пересекающимися темами
- Короткие тексты с недостаточным контекстом
- Документы на языках, отличных от английского

## Примеры использования

Система успешно классифицирует:

- Техническую документацию по компьютерной графике
- Спортивные статьи и обзоры матчей
- Медицинские исследования и публикации
- Автомобильные обзоры и технические характеристики
- Научные статьи по различным дисциплинам

## Разработка

### Процесс обучения модели

1. **Загрузка данных**: использование `fetch_20newsgroups` из scikit-learn
2. **Предобработка**: применение `preprocessing.cleaner.preprocess`
3. **Векторизация**: настройка `TfidfVectorizer` с оптимальными параметрами
4. **Обучение**: использование `tf.keras` с callbacks для оптимизации
5. **Сохранение**: модель (.keras), векторизатор (.pkl), метки (.pkl)

### Варианты обучения

#### Быстрое обучение для разработки
```bash
python train_high_accuracy.py  # 8000 документов, 25 эпох, ~5-10 минут
```

#### Полное обучение
```bash
PYTHONPATH=src python src/model/train.py  # все данные, 50 эпох, ~30-60 минут
```

### Структура артефактов

После обучения в папке `artifacts/` создаются следующие файлы:

- `model.keras` (101.8 МБ) - обученная нейронная сеть
- `vectorizer.pkl` (255 КБ) - TF-IDF векторизатор
- `labels.pkl` (389 байт) - метки классов
- `training_history.pkl` - история обучения

## Ограничения

- Качество классификации зависит от качества извлеченного текста
- Оптимизирована для документов на английском языке
- Требует предварительного обучения модели
- Не поддерживает сканированные документы без OCR
- Ограничена 20 категориями из датасета 20 Newsgroups
- Производительность может снижаться на очень коротких текстах

## Возможности для улучшения

- Добавление поддержки других языков
- Обучение на более разнообразных данных
- Реализация более сложных архитектур нейронных сетей
- Добавление поддержки других форматов документов
- Оптимизация производительности и времени обработки
- Интеграция с внешними API для расширения функциональности

## Лицензия

MIT License - подробности в файле LICENSE.
